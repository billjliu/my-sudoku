<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sudoku Mobile</title>
<style>
    :root {
        /* This ensures the board width is 95% of the narrowest screen dimension */
        --board-size: 95vw; 
        --max-board-size: 400px; /* Limits size on iPads/Laptops */
    }

    * { box-sizing: border-box; }

    body { 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        background: #f0f2f5; 
        margin: 0; 
        padding: 10px; /* Reduced padding to save space */
        touch-action: manipulation;
        overflow-x: hidden; /* Prevents side-scrolling */
    }

    #timer { 
        font-size: 1.2rem; 
        font-weight: bold; 
        margin: 15px 0 10px 0; 
        color: #333;
    }

    .grid { 
        display: grid; 
        grid-template-columns: repeat(9, 1fr); 
        width: var(--board-size);
        max-width: var(--max-board-size);
        aspect-ratio: 1 / 1; /* Keeps it a perfect square */
        border: 2px solid #000; 
        background: #000; 
        gap: 1px; 
    }

    input { 
        width: 100%; 
        height: 100%; 
        text-align: center; 
        font-size: 1.1rem; /* Slightly smaller for mobile */
        border: none; 
        outline: none; 
        background: white; 
        appearance: none; 
        -webkit-appearance: none; 
        border-radius: 0;
        padding: 0;
    }

    /* Thicker borders for 3x3 sections */
    input:nth-child(3n) { border-right: 1px solid #000; }
    input:nth-child(9n) { border-right: none; }
    .grid > input:nth-child(n+19):nth-child(-n+27),
    .grid > input:nth-child(n+46):nth-child(-n+54) { 
        border-bottom: 2px solid #000; 
    }

    .controls { 
        margin-top: 20px; 
        display: grid; 
        grid-template-columns: repeat(2, 1fr); 
        gap: 8px; 
        width: var(--board-size); 
        max-width: var(--max-board-size); 
    }

    button { 
        padding: 15px 5px; /* Taller buttons are easier to tap */
        font-size: 0.9rem; 
        border: none; 
        border-radius: 10px; 
        color: white; 
        font-weight: 600; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-new { background: #ff9800; grid-column: span 2; } /* Make New Game prominent */
    .btn-check { background: #e91e63; }
    .btn-hint { background: #2196f3; }
    .btn-solve { background: #4caf50; grid-column: span 2; }

    select { 
        padding: 12px; 
        border-radius: 10px; 
        border: 1px solid #ccc; 
        grid-column: span 2; 
        font-size: 1rem;
        background: white;
    }

    .hint { color: #2196f3; font-weight: bold; }
    .error { background-color: #ffebee; color: #d32f2f; }
</style>
</head>
<body>

<div id="timer">00:00</div>
<div class="grid" id="sudoku-grid"></div>

<div class="controls">
    <select id="difficulty">
        <option value="45">Easy</option>
        <option value="35" selected>Medium</option>
        <option value="25">Hard</option>
    </select>
    <button class="btn-new" onclick="newGame()">New Game</button>
    <button class="btn-check" onclick="checkMistakes()">Check</button>
    <button class="btn-hint" onclick="getHint()">Hint</button>
    <button class="btn-solve" onclick="solveBoardUI()">Solve</button>
</div>

<script>
    let board = [];
    let timerInterval;
    let seconds = 0;

    // Create the grid inputs
    const gridEl = document.getElementById('sudoku-grid');
    for (let i = 0; i < 81; i++) {
        const input = document.createElement('input');
        input.type = 'number';
        input.inputMode = 'numeric'; // Forces numeric keypad on iPhone
        input.oninput = function() { if(this.value.length > 1) this.value = this.value.slice(-1); };
        gridEl.appendChild(input);
    }

    function getBoardFromUI() {
        const inputs = gridEl.querySelectorAll('input');
        let b = [];
        for (let i = 0; i < 9; i++) {
            b.push(Array.from(inputs).slice(i*9, (i+1)*9).map(el => parseInt(el.value) || 0));
        }
        return b;
    }

    function setBoardToUI(b, isNew = false) {
        const inputs = gridEl.querySelectorAll('input');
        b.flat().forEach((val, i) => {
            inputs[i].value = val !== 0 ? val : '';
            if (isNew && val !== 0) inputs[i].readOnly = true;
            else if (isNew) { inputs[i].readOnly = false; inputs[i].classList.remove('hint'); }
        });
    }

    // --- Sudoku Logic ---
    function isValid(b, r, c, n) {
        for (let i = 0; i < 9; i++) {
            if (b[r][i] === n || b[i][c] === n) return false;
        }
        let sr = Math.floor(r / 3) * 3, sc = Math.floor(c / 3) * 3;
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 3; j++) {
                if (b[sr + i][sc + j] === n) return false;
            }
        }
        return true;
    }

    function solve(b) {
        for (let r = 0; r < 9; r++) {
            for (let c = 0; c < 9; c++) {
                if (b[r][c] === 0) {
                    let nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                    for (let n of nums) {
                        if (isValid(b, r, c, n)) {
                            b[r][c] = n;
                            if (solve(b)) return true;
                            b[r][c] = 0;
                        }
                    }
                    return false;
                }
            }
        }
        return true;
    }

    function newGame() {
        clearInterval(timerInterval);
        seconds = 0;
        document.getElementById('timer').innerText = "00:00";
        
        let b = Array.from({length: 9}, () => Array(9).fill(0));
        solve(b);
        let clues = parseInt(document.getElementById('difficulty').value);
        let attempts = 81 - clues;
        while (attempts > 0) {
            let r = Math.floor(Math.random()*9), c = Math.floor(Math.random()*9);
            if (b[r][c] !== 0) { b[r][c] = 0; attempts--; }
        }
        setBoardToUI(b, true);
        startTimer();
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            seconds++;
            let m = Math.floor(seconds / 60).toString().padStart(2, '0');
            let s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }, 1000);
    }

    function solveBoardUI() {
        let b = getBoardFromUI();
        if (solve(b)) {
            setBoardToUI(b);
            clearInterval(timerInterval);
        } else alert("Unsolvable!");
    }

    function getHint() {
        let current = getBoardFromUI();
        let solved = JSON.parse(JSON.stringify(current));
        if (solve(solved)) {
            let empties = [];
            current.forEach((row, r) => row.forEach((val, c) => { if(val === 0) empties.push({r,c}); }));
            if (empties.length > 0) {
                let {r, c} = empties[Math.floor(Math.random()*empties.length)];
                let input = gridEl.querySelectorAll('input')[r * 9 + c];
                input.value = solved[r][c];
                input.classList.add('hint');
            }
        }
    }

    function checkMistakes() {
        let current = getBoardFromUI();
        let solved = JSON.parse(JSON.stringify(current));
        // Note: For custom inputs, this checks if current inputs lead to a valid solution
        if (solve(solved)) {
            const inputs = gridEl.querySelectorAll('input');
            current.flat().forEach((val, i) => {
                if (val !== 0 && val !== solved.flat()[i]) inputs[i].classList.add('error');
                else inputs[i].classList.remove('error');
            });
        }
    }
</script>
</body>

</html>
